function drawIsochron(r){var o=[];$.each(r.journeys,function(r,t){o.push({to:[parseFloat(t.to.stop_point.coord.lat),parseFloat(t.to.stop_point.coord.lon)],duration:t.duration,data:t})});var t=createGeoJsonFromIsochron(o);drawGeoJson(map,t),map.on("zoomend",function(){drawGeoJson(map,t)})}function createGeoJsonFromIsochron(r){var o={name:"Points",type:"FeatureCollection",features:[]};return $.each(r,function(r,t){o.features.push({type:"Feature",geometry:{type:"Point",coordinates:t.to.reverse()},properties:{color:colorFromDuration(t.duration),journey:t.data}})}),o}function drawGeoJson(r,o){null!==geojsonLayer&&r.removeLayer(geojsonLayer),geojsonLayer=L.geoJson(o,{style:function(r){return{color:r.properties.color}},pointToLayer:function(o,t){var a=Math.pow(2,r.getZoom())/1e3;return new L.CircleMarker(t,{radius:a,fillOpacity:.6})},onEachFeature:function(r,o){var t=r.properties.journey,a=Math.floor(t.duration/60)+"min"+t.duration%60+"s ("+t.duration+"s)",e=t.links[0].href.replace("://","://"+sandboxToken+"@");o.bindPopup(["<b>"+t.to.name+"</b>",a,'<a href="'+e+'" target="_blank">Journeys to this point</a>'].join("<br>"))}}),r.addLayer(geojsonLayer)}function colorFromDuration(r){var o="FF0000",t="00FF00",a=r/maxDuration;a*=a;var e=function(r){return r=r.toString(16),1===r.length?"0"+r:r},n=Math.ceil(parseInt(o.substring(0,2),16)*a+parseInt(t.substring(0,2),16)*(1-a)),s=Math.ceil(parseInt(o.substring(2,4),16)*a+parseInt(t.substring(2,4),16)*(1-a)),i=Math.ceil(parseInt(o.substring(4,6),16)*a+parseInt(t.substring(4,6),16)*(1-a)),p=e(n)+e(s)+e(i);return"#"+p}var sandboxToken="a61f4cd8-3007-4557-9f4c-214969369cca",from=[48.846905,2.377097],maxDuration=2e3,isochronUrl="https://api.navitia.io/v1/coverage/sandbox/journeys?from="+from[1]+";"+from[0]+"&max_duration="+maxDuration;$.ajax({type:"GET",url:isochronUrl,dataType:"json",headers:{Authorization:"Basic "+btoa(sandboxToken)},success:drawIsochron,error:function(r,o,t){alert('Error when trying to process isochron: "'+o+'", "'+t+'"')}});var tiles={url:"http://www.toolserver.org/tiles/bw-mapnik/{z}/{x}/{y}.png",attrib:'Navitia Isochron example \xa9 <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'},map=L.map("map").setView(from,13).addLayer(new L.TileLayer(tiles.url,{minZoom:0,maxZoom:16,attribution:tiles.attrib}));L.marker(from).addTo(map);var geojsonLayer=null;