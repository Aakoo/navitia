function drawIsochron(o){var r=[];$.each(o.journeys,function(o,e){r.push({to:[parseFloat(e.to.stop_point.coord.lat),parseFloat(e.to.stop_point.coord.lon)],duration:e.duration,data:e})});var e=createGeoJsonFromIsochron(r);drawGeoJson(map,e),map.on("zoomend",function(){drawGeoJson(map,e)})}function createGeoJsonFromIsochron(o){var r={name:"Points",type:"FeatureCollection",features:[]};return $.each(o,function(o,e){r.features.push({type:"Feature",geometry:{type:"Point",coordinates:e.to.reverse()},properties:{color:colorFromDuration(e.duration),journey:e.data}})}),r}function drawGeoJson(o,r){null!==geojsonLayer&&o.removeLayer(geojsonLayer),geojsonLayer=L.geoJson(r,{style:function(o){return{color:o.properties.color}},pointToLayer:function(r,e){var t=Math.pow(2,o.getZoom())/1e3;return new L.CircleMarker(e,{radius:t,fillOpacity:.6})},onEachFeature:function(o,r){var e=o.properties.journey,t=Math.floor(e.duration/60)+"min"+e.duration%60+"s ("+e.duration+"s)",a=e.links[0].href.replace("://","://"+sandboxToken+"@");r.bindPopup(["<b>"+e.to.name+"</b>",t,'<a href="'+a+'" target="_blank">Journeys to this point</a>'].join("<br>"))}}),o.addLayer(geojsonLayer)}function colorFromDuration(o){var r="FF0000",e="00FF00",t=o/maxDuration;t*=t;var a=function(o){return o=o.toString(16),1===o.length?"0"+o:o},n=Math.ceil(parseInt(r.substring(0,2),16)*t+parseInt(e.substring(0,2),16)*(1-t)),s=Math.ceil(parseInt(r.substring(2,4),16)*t+parseInt(e.substring(2,4),16)*(1-t)),i=Math.ceil(parseInt(r.substring(4,6),16)*t+parseInt(e.substring(4,6),16)*(1-t)),u=a(n)+a(s)+a(i);return"#"+u}var sandboxToken="a61f4cd8-3007-4557-9f4c-214969369cca",from=[48.846905,2.377097],maxDuration=2e3,isochronUrl="https://api.navitia.io/v1/coverage/sandbox/journeys?from="+from[1]+";"+from[0]+"&max_duration="+maxDuration;$.ajax({type:"GET",url:isochronUrl,dataType:"json",headers:{Authorization:"Basic "+btoa(sandboxToken)},success:drawIsochron,error:function(o,r,e){alert('Error when trying to process isochron: "'+r+'", "'+e+'"')}});var tiles={url:"http://www.toolserver.org/tiles/bw-mapnik/{z}/{x}/{y}.png",attrib:'Navitia Isochron example \xa9 <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'},map=L.map("map").setView(from,13).addLayer(new L.TileLayer(tiles.url,{minZoom:0,maxZoom:16,attribution:tiles.attrib}));L.marker(from).addTo(map);var geojsonLayer=null;